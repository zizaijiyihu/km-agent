# KM Agent - çŸ¥è¯†ç®¡ç†æ™ºèƒ½åŠ©æ‰‹

åŸºäº LLM çš„æ™ºèƒ½çŸ¥è¯†ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒ PDF æ–‡æ¡£ä¸Šä¼ ã€å‘é‡åŒ–å­˜å‚¨ã€è¯­ä¹‰æœç´¢å’Œæ™ºèƒ½é—®ç­”ã€‚

![License](https://img.shields.io/badge/license-MIT-blue.svg)
![Python](https://img.shields.io/badge/python-3.9+-green.svg)
![Node](https://img.shields.io/badge/node-18+-green.svg)

## åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- ğŸ“„ **PDF æ–‡æ¡£ç®¡ç†** - ä¸Šä¼ ã€å­˜å‚¨ã€åˆ é™¤ PDF æ–‡æ¡£
- ğŸ” **è¯­ä¹‰æœç´¢** - åŸºäºå‘é‡æ•°æ®åº“çš„æ™ºèƒ½è¯­ä¹‰æ£€ç´¢
- ğŸ’¬ **æ™ºèƒ½é—®ç­”** - LLM é©±åŠ¨çš„çŸ¥è¯†åº“é—®ç­”ï¼Œæ”¯æŒå¤šè½®å¯¹è¯
- ğŸ–¼ï¸ **å›¾ç‰‡ç†è§£** - ç²˜è´´å›¾ç‰‡å³å¯åˆ†æï¼ŒAI è‡ªåŠ¨è¯†åˆ«å›¾ç‰‡å†…å®¹
- ğŸ“Š **å®æ—¶è¿›åº¦** - SSE æµå¼ä¸Šä¼ è¿›åº¦å±•ç¤º
- ğŸ”’ **æƒé™æ§åˆ¶** - å…¬å¼€/ç§æœ‰æ–‡æ¡£ç®¡ç†
- ğŸ“– **PDF é¢„è§ˆ** - å†…ç½® PDF æŸ¥çœ‹å™¨ï¼Œæ”¯æŒé¡µç è·³è½¬

### æŠ€æœ¯äº®ç‚¹
- **åŒè·¯å‘é‡åŒ–** - åŒæ—¶å¯¹æ‘˜è¦å’Œå…¨æ–‡å†…å®¹è¿›è¡Œå‘é‡åŒ–ï¼Œæå‡æ£€ç´¢ç²¾åº¦
- **æµå¼å“åº”** - SSE æŠ€æœ¯å®ç°å®æ—¶è¿›åº¦æ›´æ–°å’Œæµå¼å¯¹è¯
- **å›¾ç‰‡ç²˜è´´é›†æˆ** - æ”¯æŒç²˜è´´å›¾ç‰‡ï¼Œè‡ªåŠ¨ä¸Šä¼ å’Œ AI åˆ†æï¼Œç»“æœæ™ºèƒ½èå…¥å¯¹è¯
- **React + Zustand** - ç°ä»£åŒ–å‰ç«¯æ¶æ„ï¼ŒçŠ¶æ€ç®¡ç†æ¸…æ™°
- **æ¨¡å—åŒ–è®¾è®¡** - æ¸…æ™°çš„æ¨¡å—åˆ’åˆ†ï¼Œæ˜“äºæ‰©å±•å’Œç»´æŠ¤

## é¡¹ç›®æ¶æ„

> ğŸ“š **è¯¦ç»†æ¶æ„æ–‡æ¡£**: [ARCHITECTURE.md](./ARCHITECTURE.md)

```
km-agent/
â”œâ”€â”€ app_api/              # Flask API æœåŠ¡
â”œâ”€â”€ km_agent/             # çŸ¥è¯†ç®¡ç† Agent
â”œâ”€â”€ pdf_vectorizer/       # PDF å‘é‡åŒ–æ¨¡å—
â”œâ”€â”€ pdf_to_json/          # PDF è§£ææ¨¡å—
â”œâ”€â”€ file_repository/      # æ–‡ä»¶å­˜å‚¨æ¨¡å—
â”œâ”€â”€ tmp_image_repository/ # å›¾ç‰‡åˆ†ææ¨¡å—
â”œâ”€â”€ ks_infrastructure/    # åŸºç¡€è®¾æ–½æœåŠ¡
â”œâ”€â”€ ui/                   # React å‰ç«¯ç•Œé¢
â”œâ”€â”€ start.sh              # ä¸€é”®å¯åŠ¨è„šæœ¬
â””â”€â”€ stop.sh               # åœæ­¢æœåŠ¡è„šæœ¬
```

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Python 3.9+
- Node.js 18+
- Qdrant å‘é‡æ•°æ®åº“
- Embedding æœåŠ¡ï¼ˆæ”¯æŒ OpenAI å…¼å®¹æ¥å£ï¼‰
- LLM æœåŠ¡ï¼ˆæ”¯æŒ OpenAI å…¼å®¹æ¥å£ï¼‰
- Python è™šæ‹Ÿç¯å¢ƒï¼ˆç”¨äºä¾èµ–éš”ç¦»ï¼‰

### å®‰è£…ä¾èµ–

#### 1. Python ä¾èµ–
```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰
python3 -m venv $HOME/projects/venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source $HOME/projects/venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

#### 2. å‰ç«¯ä¾èµ–
```bash
cd ui
npm install
```

### é…ç½®

ä¿®æ”¹ `ks_infrastructure/configs/default.py` é…ç½®æ–‡ä»¶ï¼š

```python
# MySQLæ•°æ®åº“é…ç½®
MYSQL_CONFIG = {
    "host": "120.92.109.164",
    "port": 8306,
    "user": "admin",
    "password": "rsdyxjh",
    "database": "yanzhi"
}

# MinIOå¯¹è±¡å­˜å‚¨é…ç½®
MINIO_CONFIG = {
    "endpoint": "http://120.92.109.164:9000",  # S3 APIæœåŠ¡ç«¯å£
    "access_key": "admin",
    "secret_key": "rsdyxjh110!",
    "region": "us-east-1"
}

# Qdrantå‘é‡æ•°æ®åº“é…ç½®
QDRANT_CONFIG = {
    "url": "http://120.92.109.164:6333",
    "api_key": "rsdyxjh"
}

# OpenAIå¤§è¯­è¨€æ¨¡å‹é…ç½®
OPENAI_CONFIG = {
    "api_key": "85c923cc-9dcf-467a-89d5-285d3798014d",
    "base_url": "https://kspmas.ksyun.com/v1/",
    "model": "DeepSeek-V3.1-Ksyun"
}

# EmbeddingæœåŠ¡é…ç½®
EMBEDDING_CONFIG = {
    "url": "http://10.69.86.20/v1/embeddings",
    "api_key": "7c64b222-4988-4e6a-bb26-48594ceda8a9"
}

# Visionè§†è§‰è¯†åˆ«æœåŠ¡é…ç½®
VISION_CONFIG = {
    "api_key": "sk-412a5b410f664d60a29327fdfa28ac6e",
    "base_url": "https://dashscope.aliyuncs.com/compatible-mode/v1",
    "model": "qwen-vl-max"
}
```

### å¯åŠ¨æœåŠ¡

#### æ–¹å¼ä¸€ï¼šä¸€é”®å¯åŠ¨ï¼ˆæ¨èï¼‰
```bash
./start.sh
```

å¯åŠ¨åè®¿é—®ï¼š
- å‰ç«¯ UI: http://localhost:8080
- åç«¯ API: http://localhost:5000

åœæ­¢æœåŠ¡ï¼š
```bash
./stop.sh
```

æ³¨æ„ï¼šstart.sh è„šæœ¬éœ€è¦ Python è™šæ‹Ÿç¯å¢ƒï¼Œå¯ä»¥é€šè¿‡ VENV_PATH ç¯å¢ƒå˜é‡æŒ‡å®šè™šæ‹Ÿç¯å¢ƒè·¯å¾„ï¼š
```bash
VENV_PATH=/path/to/your/venv ./start.sh
```

é»˜è®¤è™šæ‹Ÿç¯å¢ƒè·¯å¾„ä¸º `$HOME/projects/venv`ã€‚

#### æ–¹å¼äºŒï¼šæ‰‹åŠ¨å¯åŠ¨

**å¯åŠ¨åç«¯ï¼š**
```bash
python -m app_api.api
```

**å¯åŠ¨å‰ç«¯ï¼š**
```bash
cd ui
npm run dev
```

## API æ¥å£

### 1. èŠå¤©æ¥å£
```
POST /api/chat
```
ä¸ KM Agent å¯¹è¯ï¼Œæ”¯æŒå¤šè½®è¿ç»­å¯¹è¯

### 2. è·å–æ–‡æ¡£åˆ—è¡¨
```
GET /api/documents
```
è·å–ç”¨æˆ·æœ‰æƒè®¿é—®çš„æ–‡æ¡£åˆ—è¡¨

### 3. ä¸Šä¼ å¹¶å‘é‡åŒ– PDF
```
POST /api/upload
```
ä¸Šä¼  PDF æ–‡ä»¶å¹¶å‘é‡åŒ–ï¼Œæ”¯æŒ SSE å®æ—¶è¿›åº¦

### 4. åˆ é™¤æ–‡æ¡£
```
DELETE /api/documents/<filename>
```
åˆ é™¤æŒ‡å®šæ–‡æ¡£

### 5. ä¿®æ”¹æ–‡æ¡£å¯è§æ€§
```
PUT /api/documents/<filename>/visibility
```
ä¿®æ”¹æ–‡æ¡£ä¸ºå…¬å¼€/ç§æœ‰

### 6. è·å– PDF æ–‡ä»¶å†…å®¹
```
GET /api/documents/<filename>/content
```
è·å– PDF æ–‡ä»¶å†…å®¹ç”¨äºæŸ¥çœ‹

### 7. å›¾ç‰‡åˆ†æ
```
POST /api/analyze-image
```
ä¸Šä¼ å›¾ç‰‡å¹¶ä½¿ç”¨ AI è§†è§‰æœåŠ¡åˆ†æå†…å®¹

## æ¨¡å—ä»‹ç»

### 1. app_api - API æœåŠ¡å±‚
åŸºäº Flask çš„ HTTP API æœåŠ¡ï¼Œæä¾›çŸ¥è¯†ç®¡ç†åŠŸèƒ½çš„ RESTful æ¥å£ã€‚

### 2. km_agent - çŸ¥è¯†ç®¡ç† Agent
æ ¸å¿ƒæ™ºèƒ½ä»£ç†ï¼Œè´Ÿè´£è¯­ä¹‰æœç´¢ã€çŸ¥è¯†é—®ç­”å’Œå·¥å…·è°ƒç”¨ã€‚

### 3. pdf_vectorizer - PDF å‘é‡åŒ–
å°† PDF æ–‡æ¡£å‘é‡åŒ–å¹¶å­˜å‚¨åˆ° Qdrant å‘é‡æ•°æ®åº“ï¼Œæ”¯æŒå®æ—¶è¿›åº¦è·Ÿè¸ªã€‚

### 4. pdf_to_json - PDF è§£æ
å°† PDF æ–‡ä»¶è½¬æ¢ä¸ºç»“æ„åŒ–çš„ JSON æ ¼å¼ï¼Œä¿ç•™æ–‡æœ¬å’Œå›¾ç‰‡çš„ç›¸å¯¹ä½ç½®ã€‚

### 5. file_repository - æ–‡ä»¶å­˜å‚¨
åŸºäº MinIO æä¾›æ–‡ä»¶ä¸Šä¼ å’ŒæŸ¥è¯¢çš„å­˜å‚¨ä»“åº“æœåŠ¡ï¼Œä½¿ç”¨ MySQL ç®¡ç†æ–‡ä»¶å…ƒæ•°æ®ã€‚

### 6. tmp_image_repository - å›¾ç‰‡åˆ†æ
å›¾ç‰‡ä¸Šä¼ åˆ°ä¸´æ—¶å­˜å‚¨å¹¶ä½¿ç”¨è§†è§‰è¯†åˆ«æœåŠ¡åˆ†æå›¾ç‰‡å†…å®¹ï¼Œæ”¯æŒç²˜è´´å›¾ç‰‡å¿«é€Ÿåˆ†æã€‚

### 7. ks_infrastructure - åŸºç¡€è®¾æ–½
ç»Ÿä¸€çš„æœåŠ¡å·¥å‚æ–¹æ³•ï¼Œç”¨äºåˆ›å»ºå’Œç®¡ç†å„ç§åŸºç¡€è®¾æ–½æœåŠ¡å®ä¾‹ã€‚

## è®¸å¯è¯

MIT License
